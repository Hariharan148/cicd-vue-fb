# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Prod
on:
  pull_request:
    types: [closed]
    branches:
      - main
      - dev
      
env:
  FIREBASE_PROJECT_ID: cicd-test-prod
  FIREBASE_ENVIRONMENT: cicd-test-prod
  FIREBASE_PROJECT_ID_DEV: cicd-test-dev-b73fa
  FIREBASE_ENVIRONMENT_DEV: cicd-test-dev-b73fa

jobs:
  deploy_prod:
    if: github.base_ref == 'main' && github.event.pull_request.merged == true
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
      - run: 'npm ci && npm run build:prod'
      - name: Install Firebase CLI
        run: |
          curl -sL https://firebase.tools | bash
          firebase --version

      - name: Firebase Login
        run: firebase login:ci --no-localhost --interactive
      
      - name: Firebase Use
        run: |
          firebase use --add ${{ env.FIREBASE_PROJECT_ID }}
          firebase use ${{ env.FIREBASE_ENVIRONMENT }}
      
      - name: Firebase Deploy
        run: |
          firebase deploy --only hosting --project ${{ env.FIREBASE_PROJECT_ID }} --message "Deployed from GitHub Actions"

  deploy_dev:
    if: github.base_ref == 'dev' && github.event.pull_request.merged == true
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
      - run: 'npm ci && npm run build:dev'
      - name: Install Firebase CLI
        run: |
          curl -sL https://firebase.tools | bash
          firebase --version

      - name: Firebase Login
        run: firebase login:ci --no-localhost --interactive
      
      - name: Firebase Use
        run: |
          firebase use --add ${{ env.FIREBASE_PROJECT_ID_DEV }}
          firebase use ${{ env.FIREBASE_ENVIRONMENT_DEV }}
      
      - name: Firebase Deploy
        run: |
          firebase deploy --only hosting --project ${{ env.FIREBASE_PROJECT_ID_DEV }} --message "Deployed from GitHub Actions"

